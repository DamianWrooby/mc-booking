<app-layout>
  <h1 class="text-2xl font-bold mb-6">Zarządzanie użytkownikami</h1>

  @if (loading()) {
    <div class="flex justify-center items-center py-12">
      <p-progressSpinner strokeWidth="4" />
    </div>
  } @else if (users().length === 0) {
    <div class="text-center py-12 text-surface-500 dark:text-surface-400">
      <i class="pi pi-users text-4xl mb-4"></i>
      <p>Brak użytkowników do wyświetlenia</p>
    </div>
  } @else {
    <ul class="flex flex-col gap-4">
      @for (user of users(); track user.id) {
        <li class="p-4 bg-surface-50 dark:bg-surface-800 rounded-lg border border-surface-200 dark:border-surface-700">
          <!-- Username header -->
          <div class="flex items-center justify-between mb-3">
            <span class="text-lg font-semibold">{{ user.username }}</span>
            @if (isCurrentUser(user)) {
              <span class="text-sm text-surface-500 dark:text-surface-400">(Ty)</span>
            }
          </div>

          <!-- Divider -->
          <div class="h-px bg-surface-200 dark:bg-surface-700 mb-3"></div>

          <!-- Role info section -->
          <div class="flex flex-col gap-3">
            <!-- Current role -->
            <div class="flex items-center gap-2">
              <span class="text-sm font-medium text-surface-600 dark:text-surface-400">
                Aktualna rola:
              </span>
              <p-tag [value]="user.role" [severity]="getRoleSeverity(user.role)" />
            </div>

            <!-- Role change control -->
            @if (isCurrentUser(user)) {
              <div class="flex flex-col gap-2">
                <span class="text-sm font-medium text-surface-600 dark:text-surface-400">
                  Zmień rolę:
                </span>
                <span class="text-sm text-surface-500 dark:text-surface-400">
                  Nie możesz zmienić własnej roli
                </span>
              </div>
            } @else {
              <div class="flex flex-col gap-2">
                <label for="role-{{ user.id }}" class="text-sm font-medium text-surface-600 dark:text-surface-400">
                  Zmień rolę:
                </label>
                <p-select
                  inputId="role-{{ user.id }}"
                  [options]="roleOptions"
                  [ngModel]="user.role"
                  (ngModelChange)="onRoleChange(user, $event)"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Wybierz rolę"
                  class="w-full"
                />
              </div>
            }
          </div>
        </li>
      }
    </ul>
  }

  <p-confirmDialog />
</app-layout>
